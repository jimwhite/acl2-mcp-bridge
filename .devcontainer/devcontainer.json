{
    "name": "ACL2-Jupyter",
    "image": "ghcr.io/jimwhite/acl2-jupyter:latest",
    "forwardPorts": [
        8899
    ],
    "portsAttributes": {
        "8899": {
            "label": "Jupyter",
            "requireLocalPort": true
        }
    },
    "containerEnv": {
        "JUPYTER_PORT": "8899",
        "RESTARTABLE": "yes"
    },
    // remoteEnv supports ${containerEnv:VAR} syntax for PATH modification
    "remoteEnv": {
        "VIRTUAL_ENV": "/workspaces/acl2-mcp-bridge/.venv",
        "PATH": "/workspaces/acl2-mcp-bridge/.venv/bin:${containerEnv:PATH}",
        "ASDF_SOURCE_REGISTRY": "(:source-registry (:tree \"/workspaces/acl2-mcp-bridge/\") :inherit-configuration)",
        "CL_SOURCE_REGISTRY": "/workspaces/acl2-mcp-bridge//:"
    },
    // Create venv if it doesn't exist, install packages
    "postCreateCommand": "[ -d /workspaces/acl2-mcp-bridge/.venv ] || (python3 -m venv /workspaces/acl2-mcp-bridge/.venv && /workspaces/acl2-mcp-bridge/.venv/bin/pip install --upgrade pip)",
    // Add venv activation to bashrc so terminals show (.venv) prompt
    "postStartCommand": "grep -q 'source.*\\.venv/bin/activate' ~/.bashrc || echo 'source /workspaces/acl2-mcp-bridge/.venv/bin/activate' >> ~/.bashrc",
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-python.vscode-pylance",
                "ms-toolsai.jupyter"
            ],
            "settings": {
                "python.defaultInterpreterPath": "/workspaces/acl2-mcp-bridge/.venv/bin/python",
                "python.terminal.activateEnvironment": true,
                "python.terminal.activateEnvInCurrentTerminal": true
            }
            // "mcp": {
            //     "servers": {
            //         "acl2-mcp": {
            //             "command": "/workspaces/acl2-mcp-bridge/.venv/bin/acl2-mcp",
            //             "args": [],
            //             "env": {
            //                 "ACL2_HOME": "/home/acl2",
            //                 "ACL2_SYSTEM_BOOKS": "/home/acl2/books",
            //                 "ACL2": "/opt/acl2/bin/saved_acl2",
            //                 "SBCL_USER_ARGS": "--noinform",
            //                 "VIRTUAL_ENV": "/workspaces/acl2-swf-experiments/.venv",
            //                 "PATH": "/workspaces/acl2-swf-experiments/.venv/bin:/opt/acl2/bin:/opt/conda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            //             }
            //         }
            //     }
            // }
        }
    }
}
